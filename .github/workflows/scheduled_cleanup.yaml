name: Scheduled Cleanup repo

on:
  push:
  schedule:
    - cron: '30 00 * * sun'
  workflow_dispatch:
    inputs:
        number_days_old:
            description: "pass this value, all the files older than this value will be deleted from our repository. By default, this value is set to 30 days."
            required: false
            default: "" 
        branch_name:
            description: "deletion by the name of the branch_name"
            required: false
            default: ""

jobs:
  jfrog_packages_cleanup:
     name: install jfrog cli
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v2
       - uses: jfrog/setup-jfrog-cli@v2
         env:
           JF_ENV_DEVOPS: ${{secrets.JF_SECRET_ENV_DEVOPS}}
       - run: |
           var=""
           varb=8
           if [ -n "$var" ]; then
            jf rt s dart.xayn.private/ | grep $var
           fi
           
           if [ -n "$varb" ]; then
            sed -i 's/number_days_limit/$varb/g' .github/scripts/artifactory.spec
            jf c use xayn
            cat .github/scripts/artifactory.spec
            # Ping xayn Artifactory server
            jf rt ping
            jf rt s --spec .github/scripts/artifactory.spec
           fi
